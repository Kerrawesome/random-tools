<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <title>Bing Chilling Stream</title>
    <link rel="icon" href="https://em-content.zobj.net/source/google/387/soft-ice-cream_1f366.png" type="image/png">
      <style>
		* {
			box-sizing: border-box;
			scrollbar-width: none; /* For Firefox */
			-ms-overflow-style: none; /* For Internet Explorer and Edge */
		}

		*::-webkit-scrollbar {
			display: none; /* For WebKit browsers (Chrome, Safari) */
		}

		body {
			margin: 0;
			padding: 0;
			width: 100%;
			max-width: 100vw;
			font-family: 'Roboto', sans-serif;
			padding-bottom: 20px;
			text-align: center; /* Center text and inline elements */
		}

		/* Title Section */
		.title-container {
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.title-text {
			text-align: left;
			margin-top: 20px;
		}

		.title-text h1, 
		.title-text h2,
		.title-text h3 {
			margin: 0;
		}

		.title-image {
			width: 80px;
			height: auto;
			border-radius: 5px;
			margin-top: 20px;
		}
		.button-container {
			display: block; /* Block display */
			margin: 20px auto; /* Center horizontally and space below title */
			width: fit-content; /* Fit to content */
		}

		input[type="text"] {
			padding: 10px;
			border-radius: 5px;
			border: 1px solid black;
			background-color: #f4f4f4;
			text-align: center; /* Center placeholder text */
			display: block;
			margin-left: auto;
			margin-right: auto; /* Ensure it's fully centered */
		}

		.results-container {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
			gap: 10px;
			padding: 10px;
			width: 90%;
			margin: 0 auto; /* Center the results grid */
		}

		.result-item {
			padding: 10px;
			background-color: #f4f4f4;
			border-radius: 8px;
			cursor: pointer;
			display: flex;
			flex-direction: column;
			align-items: center; /* Center the content inside */
			transition: background-color 0.3s;
		}

		.result-item:hover {
			background-color: #e0e0e0;
		}

		.result-item img {
			width: 80px;
			height: 80px;
			object-fit: contain;
			border-radius: 8px;
			margin-bottom: 5px;
		}

		.result-item h3 {
			font-size: 14px;
			margin: 0;
			text-align: center;
		}

		.player-container {
			padding-left: 20px;
			padding-right: 20px;
			padding-top: 20px;
			width: 100%;
			max-width: 800px;
			margin-left: auto;
			margin-right: auto; /* Center horizontally */
			text-align: center; /* Ensure inner content is centered */
		}

		video {
			width: 100%;
			max-width: 800px;
		}

		audio {
			width: 100%;
			max-width: 600px;
			border-radius: 12px;
			margin-top: 10px;
			margin-left: auto;
			margin-right: auto; /* Ensure it's fully centered */
		}

		.player-info {
			text-align: center;
			margin-top: 10px;
		}

		.player-logo {
			width: 200px;
			height: auto;
			border-radius: 10px;
		}
		
		button {
			padding: 8px;
			border-radius: 5px;
			border: 1px solid black;
		}
		
		input[type="text"] {
			width: 60%; /* Adjust width as needed */
			max-width: 300px; /* Set a smaller max-width */
			text-align: left; /* Ensure placeholder text is left-aligned */
		}

		.hidden {
			display: none;
		}
		
    </style> 
</head>
 
<body>
    <div class="title-container">
        <img src="https://em-content.zobj.net/source/google/387/soft-ice-cream_1f366.png" alt="Ice Cream Icon" class="title-image">
        <div class="title-text">
            <h1>Bing Chilling</h1>
            <h2>Stream | <a href="index.html">media</a></h2>
			<h3>By Kerrawesome</h3>
			
        </div>
    </div>

    <div class="button-container">
        <button onclick="loadTV()">TV</button>
        <button onclick="loadRadio()">Radio</button>
    </div>

    <input type="text" id="searchBar" placeholder="Search" oninput="debounceFilter()" />

    <div id="resultsContainer" class="results-container"></div>

    <div id="playerContainer" class="player-container hidden"></div> <!-- Invisible container for the player -->

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        let tvResults = [];
        let radioResults = [];
        let currentListings = [];
        let debounceTimer;  // To handle debouncing

        // Load TV shows from the m3u8 file
        async function loadTV() {
            resetPlayer();
            clearResults();

            const tvResponse = await fetch('https://i.mjh.nz/nz/raw-tv.m3u8');
            const tvData = await tvResponse.text();
            const tvLines = tvData.split('\n');

            let currentItem = {};

            tvResults = []; // Clear previous tvResults array

            tvResults.push({
                name: 'TV Guide',
                logo: 'https://upload.wikimedia.org/wikipedia/en/2/20/Freeview_2023.svg',
                url: 'https://freeviewnz.tv/tvguide/whats-on/?st=streaming',
                isTVGuide: true
            });

            // Process the m3u8 lines to get TV channels
            tvLines.forEach(line => {
                if (line.startsWith('#EXTINF')) {
                    const channelInfo = line.match(/tvg-logo="([^"]+)"/);
                    currentItem = {
                        name: line.split(',')[1],
                        logo: channelInfo ? channelInfo[1] : '',
                        isDiscovery: line.includes('mjh-discovery'),
                        isTrackside: line.toLowerCase().includes('tab trackside')
                    };
                } else if (line.startsWith('http')) {
                    currentItem.url = line;
                    tvResults.push(currentItem);
                }
            });

            // Custom sort for TV channels (preserving custom ordering for mjh-discovery)
            tvResults.sort((a, b) => {
                if (a.isDiscovery && b.isDiscovery) {
                    return 0;
                }
                if (a.isDiscovery) {
                    return 1;
                }
                if (b.isDiscovery) {
                    return -1;
                }
                return 0;
            });

            currentListings = [...tvResults]; // Store in currentListings for filtering
            displayResults(currentListings, 'video');
        }

        // Load Radio stations from the m3u8 file
        async function loadRadio() {
            resetPlayer();
            clearResults();

            const radioResponse = await fetch('https://i.mjh.nz/nz/raw-radio.m3u8');
            const radioData = await radioResponse.text();
            const radioLines = radioData.split('\n');

            let currentItem = {};

            radioResults = []; // Clear previous radioResults array

            radioResults.push({
                name: 'Random Station',
                logo: 'https://em-content.zobj.net/source/microsoft/379/game-die_1f3b2.png',
                url: 'random'
            });

            // Process the m3u8 lines to get radio stations
            radioLines.forEach(line => {
                if (line.startsWith('#EXTINF')) {
                    const channelInfo = line.match(/tvg-logo="([^"]+)"/);
                    currentItem = {
                        name: line.split(',')[1].replace(/\//g, ' / '),
                        logo: channelInfo ? channelInfo[1] : ''
                    };
                } else if (line.startsWith('http')) {
                    currentItem.url = line;
                    radioResults.push(currentItem);
                }
            });

            // Custom sort for radio stations
            radioResults.sort((a, b) => {
                const isPriorityA = a.name.toLowerCase().includes('auckland') || a.name.toLowerCase().includes('more fm network') || a.name.toLowerCase().includes('chinese radio') || a.name.toLowerCase().includes('chinese voice');
                const isPriorityB = b.name.toLowerCase().includes('auckland') || b.name.toLowerCase().includes('more fm network') || b.name.toLowerCase().includes('chinese radio') || b.name.toLowerCase().includes('chinese voice');

                if (isPriorityA && isPriorityB) {
                    return b.name.localeCompare(a.name); // Inverse alphabetical for priority
                }

                if (!isPriorityA && !isPriorityB) {
                    return a.name.localeCompare(b.name); // Regular alphabetical for others
                }

                return isPriorityA ? -1 : 1;
            });

            currentListings = [...radioResults]; // Store in currentListings for filtering
            displayResults(currentListings, 'audio');
        }

        // Display TV or Radio results in grid
        function displayResults(results, type) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = ''; // Clear previous results

            results.forEach(result => {
                const item = document.createElement('div');
                item.classList.add('result-item');

                item.innerHTML = `
                    <img src="${result.logo}" alt="${result.name}">
                    <h3>${result.name}</h3>
                `;
                item.onclick = () => {
                    if (result.name === 'TV Guide') {
                        window.open(result.url, '_blank'); // Open Freeview TV Guide in new window
                    } else if (result.url === 'random') {
                        playRandomStation();
                    } else if (type === 'video') {
                        showPlayer('video', result.url);
                    } else if (type === 'audio') {
                        showPlayer('audio', result.url, result.logo, result.name);
                    }
                };
                container.appendChild(item);
            });
        }

        // Show the player for TV or Radio streams
        function showPlayer(type, streamUrl, logoUrl = '', name = '') {
            const playerContainer = document.getElementById('playerContainer');
            playerContainer.innerHTML = ''; // Clear previous player
            const resultsContainer = document.getElementById('resultsContainer');

            if (type === 'video') {
                const videoPlayer = document.createElement('video');
                videoPlayer.controls = true;
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(streamUrl);
                    hls.attachMedia(videoPlayer);
                    hls.on(Hls.Events.MEDIA_ATTACHED, () => {
                        videoPlayer.play();
                    });
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoPlayer.src = streamUrl;
                    videoPlayer.play();
                }
                playerContainer.appendChild(videoPlayer);
            } else if (type === 'audio') {
                const logoImg = document.createElement('img');
                logoImg.src = logoUrl;
                logoImg.alt = name;
                logoImg.classList.add('player-logo');

                const channelName = document.createElement('h3');
                channelName.textContent = name;
                channelName.classList.add('player-info');

                const audioPlayer = document.createElement('audio');
                audioPlayer.controls = true;

                if (streamUrl.endsWith('.m3u8')) {
                    if (Hls.isSupported()) {
                        const hls = new Hls();
                        hls.loadSource(streamUrl);
                        hls.attachMedia(audioPlayer);
                        hls.on(Hls.Events.MEDIA_ATTACHED, () => {
                            audioPlayer.play();
                        });
                    } else if (audioPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                        audioPlayer.src = streamUrl;
                        audioPlayer.play();
                    }
                } else {
                    audioPlayer.src = streamUrl;
                    audioPlayer.play();
                }

                playerContainer.appendChild(logoImg);
                playerContainer.appendChild(channelName);
                playerContainer.appendChild(audioPlayer);
            }

            // Hide listings and show the player
            resultsContainer.classList.add('hidden');
            playerContainer.classList.remove('hidden');
        }

        // Play a random radio station
        function playRandomStation() {
            const randomStation = radioResults[Math.floor(Math.random() * radioResults.length)];
            showPlayer('audio', randomStation.url, randomStation.logo, randomStation.name);
        }

        // Debounce for search functionality
        function debounceFilter() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(filterListings, 300); // Wait 300ms after the last keystroke
        }

        // Filter listings based on search query
        function filterListings() {
            const query = document.getElementById('searchBar').value.toLowerCase();
            const filteredResults = currentListings.filter(result => result.name.toLowerCase().includes(query));
            displayResults(filteredResults, 'video'); // Display filtered results
        }

        // Reset the player screen and show results container
        function resetPlayer() {
            const playerContainer = document.getElementById('playerContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            playerContainer.innerHTML = '';
            playerContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
        }

        // Clear results container
        function clearResults() {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = ''; // Clear previous results
        }

    </script>
</body>

</html>
